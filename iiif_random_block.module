<?php

/**
 * @file
 * Primary module file for the IIIF Random Block module.
 */

// Add this line to import the SettingsForm class.
use Drupal\iiif_random_block\Form\SettingsForm;

/**
 * Implements hook_cron().
 */
function iiif_random_block_cron() {
  $logger = \Drupal::logger('iiif_random_block');
  $state = \Drupal::state();
  $time = \Drupal::time();
  $config = \Drupal::config('iiif_random_block.settings');

  $cron_interval = $config->get('cron_interval') ?: 86400;
  $last_run = $state->get('iiif_random_block.last_cron_run', 0);

  if (($time->getRequestTime() - $last_run) < $cron_interval) {
    return;
  }

  $logger->info('Cron job started: Calling updateDisplayedImages.');

  // Call the static method to do the work, passing values directly.
  SettingsForm::updateDisplayedImages(
    (int) ($config->get('number_of_images') ?: 5),
    (int) ($config->get('image_size') ?: 800),
    (string) $config->get('selection_rules')
  );

  $state->set('iiif_random_block.last_cron_run', $time->getRequestTime());
  $logger->info('Cron job finished.');
}

/**
 * Implements hook_theme().
 */
function iiif_random_block_theme($existing, $type, $theme, $path) {
  return [
    'iiif_random_block' => [
      'variables' => [
        'items' => [],
        'source_link_text' => '',
        'source_link' => '',
  'aspect_ratio' => '1 / 1',
      ],
    ],
  ];
}
